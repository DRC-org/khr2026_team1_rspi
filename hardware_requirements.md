# ソフトウェア実装に基づくハードウェア要件定義

現在のプログラム（ROS 2 / ESP32）が前提としている物理構成および電装仕様です。実機製作・配線時のマスターガイドとして使用してください。

## 1. 制御基板（ESP32 #2: Mechanism Controller）
`khr2026_team1_hwmc` のコードに基づく要件です。

### 1.1 リミットスイッチ（ホーミング用）
プログラム起動時に原点復帰（ホーミング）が走ります。スイッチが両方反応するまでコマンドを受け付けません。
*   **昇降 1 軸**: GPIO 34 に接続。
*   **昇降 2 軸**: GPIO 35 に接続。
*   **論理**: `INPUT_PULLUP` 設定。スイッチ押下時に `GND` と短絡（`LOW`）すること。

### 1.2 CAN 1 系統（メカ系バス）
以下の ID を持つモジュールが同一バス上に存在し、規定の値を返す必要があります。
*   **電源供給基板 (0x100)**: 起動直後に `cmd: 0x00, data[1-3]: 0x01`（全ON）を受信して出力を開始すること。
*   **12V 電圧監視 (0x10)**: `data[1-2]` に `電圧[V] * 100` の値を載せて定期送信すること。
*   **各モータ/サーボ基板**: 動作完了時に以下のフィードバック ID を 1 回送信すること（これを待って次の行動に移ります）。
    *   昇降 1 / 2 完了: `0x30` / `0x31`
    *   櫓ハンド 1 / 2 完了: `0x40` / `0x41`
    *   リングハンド移動/開閉完了: `0x4A` 〜 `0x4D`

---

## 2. 制御基板（ESP32 #1: Drive Controller）
`khr2026_team1_cwmc` のコードに基づく要件です。

### 2.1 駆動系（Mecanum Drive）
*   **モータ**: DJI M3508 x 4台（C620 ESC 使用）。
*   **配置**:
    *   Front Left (0x201), Front Right (0x202)
    *   Rear Left (0x203), Rear Right (0x204)
*   **幾何パラメータ**:
    *   ホイール半径: `0.04925 m`
    *   中心からタイヤまでの距離: `X: 0.1725 m`, `Y: 0.2425 m`
    *   ギア比: `19.2032`
*   **IMU**: LSM9DS1 が SPI/I2C 経由で `imu_controller` から正常に読み取れること。

### 2.2 CAN 2 系統（足回り系バス）
*   **24V 電圧監視 (0x101)**: `data[1-2]` に `電圧[V] * 100` を載せて送信すること。

---

## 3. 自律制御（Mission Control）
`robot_control` パッケージの行動計画が前提とする物理能力です。

### 3.1 積載能力（Capacity）
*   **櫓**: 同時に **2個** まで保持可能であること。
*   **リング**: 同時に **4個** まで保持可能であること。
*   ※これを超える計画はプランナー側で制限されています。

### 3.2 動作速度・タイムアウト
*   **移動速度**: `nav2` で `0.5 m/s` 程度の巡航ができること。
*   **動作待機**: 各メカアクション（昇降など）は最大 **15秒以内** に完了し、フィードバック ID を返すこと。これを超えるとソフトウェア側でタイムアウト（失敗）判定となります。

## 4. 通信（micro-ROS）
*   **Agent 接続**: Raspberry Pi (192.168.0.101:8888) に対して Wi-Fi 経由で接続可能なネットワーク環境があること。
*   **トピック**:
    *   指令: `/robot_control` (JSON String)
    *   報告: `/robot_status` (JSON String)
