# ハードウェア・実機調整 TODO リスト

ソフトウェア（ROS 2 / ESP32）の実装に基づき、実機側で対応・確認が必要な項目です。

## 1. 電装・配線（Wiring & Electronics）

- [ ] **リミットスイッチの実装 (Homing)**
    - 昇降機構 1 および 2 にリミットスイッチを設置し、以下のピンに接続すること。
    - 昇降 1: GPIO 34 (HWMC ESP32)
    - 昇降 2: GPIO 35 (HWMC ESP32)
    - プルアップ設定（内部プルアップを使用中）を確認し、スイッチ押下時に `LOW` になることを確認。
- [ ] **CAN バスの終端抵抗**
    - CAN 1（メカ系）と CAN 2（足回り系）のそれぞれの末端モジュールに 120Ω の終端抵抗が実装されているか確認。
- [ ] **電源制御基板のロジック実装**
    - CAN ID `0x100` のコマンド `0x00` を受け取った際、各モータドライバへの 12V/24V 供給を物理的に ON にする回路/プログラムが動作するか確認。
- [ ] **バッテリ電圧監視の校正**
    - 電源供給基板から送られる電圧値（CAN ID `0x10`, `0x101`）がテスターの測定値と一致するよう、分圧比の定数を調整。

## 2. センサ・パラメータ調整（Calibration）

- [ ] **足回り定数の実測と修正**
    - `WHEEL_RADIUS` (現在 0.04925m) および `GEAR_RATIO` (現在 19.2032) を実際のタイヤとギアに合わせて修正。
    - 1メートル直進させた際、オドメトリ（`/odom`）が正確に 1.0 を示すか確認。
- [ ] **IMU (LSM9DS1) の取付向き**
    - IMU の軸方向がロボットの座標系（前方 +X, 左方 +Y）と一致しているか確認。
    - Yaw角のドリフトが許容範囲内か確認し、必要なら `lsm9ds1_control` 内で補正値を設定。
- [ ] **リフトのソフトリミット設定**
    - `mission_control_node.py` 内の `lift_msg.data`（現在最大 0.4m）が物理的な限界を超えていないか確認。

## 3. 通信・フィードバック（Communication）

- [ ] **各モジュール側の完了通知 ID 送信**
    - 各モータドライバやサーボ基板が、動作完了時に以下の ID を CAN バスに流すよう実装されているか確認。
    - 昇降完了: `0x30` / `0x31`
    - ハンド完了: `0x40` / `0x41`
    - リングハンド移動/動作完了: `0x4A` 〜 `0x4D`
- [ ] **micro-ROS の安定性確認**
    - Wi-Fi 環境下での通信遅延（Latency）を測定し、PID 制御周期（3ms）に影響を与えていないか確認。必要なら有線 Serial 通信への切り替えを検討。

## 4. 安全・規定遵守（Compliance & Safety）

- [ ] **非常停止スイッチ (E-Stop)**
    - 全ての駆動電源を遮断できる物理スイッチが、規定通りの色（黄色の背景に赤ボタン）で設置されているか。
- [ ] **重量・サイズ計測**
    - 総重量が 20kg 以下であることの確認。
    - 初期サイズ（700mm角）および展開サイズ（1000mm角）に収まっているかの確認。

## 5. フィールド試験（Field Test）

- [ ] **把持力の確認**
    - 櫓ハンドが VU100 管を滑らずに保持できるか。
    - リングハンドが投げ輪を確実にリリースできるか。
- [ ] **Nav2 パラメータの追い込み**
    - ロンリウム上での加速・減速時にタイヤが滑らないよう、`nav2_params.yaml` の最大加速度を調整。
